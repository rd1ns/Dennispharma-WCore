@{
    ViewData["PageMainTitle"] = "Menü Yönetimi";
    ViewData["PageTitle"] = "Menü Listesi";
    ViewData["Title"] = ViewData["PageTitle"] + " / " + ViewData["PageMainTitle"];
    ViewData["ControllerName"] = "menu";
    ViewData["DeleteActionName"] = "addoredit";
}
<div class="content  d-flex flex-column flex-column-fluid" id="kt_content">
    <div class="subheader py-2 py-lg-6  subheader-solid " id="kt_subheader">
        <div class=" container-fluid  d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
            <div class="d-flex align-items-center flex-wrap mr-1">
                <div class="d-flex align-items-baseline flex-wrap mr-5">
                    <h5 class="text-dark font-weight-bold my-1 mr-5">
                        @ViewData["PageTitle"]
                    </h5>
                    <ul class="breadcrumb breadcrumb-transparent breadcrumb-dot font-weight-bold p-0 my-2 font-size-sm">
                        <li class="breadcrumb-item">
                            <a href="" class="text-muted">
                                @ViewData["PageMainTitle"]
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="d-flex align-items-center">
                <a href="/Admin/@ViewData["ControllerName"]/AddOrEdit/0" class="btnDisableable btn btn-sm btn-success font-weight-bolder mr-2">
                    <i class="ki ki-plus icon-xs"></i>
                    @T("Admin.Configuration.AddNew")
                </a>
            </div>
        </div>
    </div>
    <div class="d-flex flex-column-fluid">
        <div class=" container-fluid ">
            <div class="card card-custom">
                <div class="card-body">
                    <div id="menu_datatable"></div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script>
        var dataSource = new kendo.data.TreeListDataSource({
            transport: {
                type: "json",
                read: {
                    url: "/Admin/menu/GetFilteredItems",
                    type: "POST",
                    dataType: "json",
                    contentType: "application/json"
                }
            },
            schema: {
                model: {
                    id: "Id",
                    parentId: "ParentId",
                    fields: {
                        Id: { type: "number", nullable: false },
                        ParentId: { field: "ParentId", nullable: true, editable: true, type: "number" },
                        Name: { editable: true, type: "string" },
                        Slug: { editable: true, type: "string" },
                        DisplayOrder: { editable: true, type: "number" },
                        IsActive: { editable: true, type: "bool" }
                    }
                }
            },
            requestEnd: function (e) {
                console.log(e.type);
                if (e.type == "create" || e.type == "update") {
                    this.read();
                }
            },
            error: function (e) {
                display_kendoui_grid_error(e);
                // Cancel the changes
                this.cancelChanges();
            },
        });
        $(document).ready(function () {
            $("#menu_datatable").kendoTreeList({
                dataSource: dataSource,
                height: 540,
                autoSync: true,
                toolbar: ["search"],
                columns: [{
                    field: "Id",
                    title: "Gizlilik",
                    headerAttributes: { style: "text-align:center" },
                    attributes: { style: "text-align:center" },
                    template: "# if (IsHidden == false) { #" +
                        "<div class='float-left d-inline text-center'> <span class='kt-switch kt-switch--outline kt-switch--sm kt-switch--icon kt-switch--success'> <label> <input type='checkbox' data-type='IsHidden' data-menuid='#=Id#' > <span></span> </label> </span> </div>" +
                        "# } else { #" +
                        "<div class='float-left d-inline text-center'> <span class='kt-switch kt-switch--outline kt-switch--sm kt-switch--icon kt-switch--success'> <label> <input type='checkbox' data-type='IsHidden' checked='' data-menuid='#=Id#'> <span></span> </label> </span> </div>" +
                        "# } #",
                    width: 50,
                }, {
                    field: "Name",
                    title: "Name",
                    width: 300,
                }, {
                    field: "Slug",
                    title: "Slug",
                    width: 300,
                },{
                    field: "DisplayOrder",
                    title: "DisplayOrder",
                    width: 50,
                }, {
                    field: "IsHidden",
                    title: "IsHidden",
                    width: 50,
                },   {
                    field: "IsActive",
                    title: "Durum",
                    headerAttributes: { style: "text-align:center" },
                    attributes: { style: "text-align:center" },
                    template: "# if (IsActive == false) { #" +
                        "<div class='col-3 text-center'> <span class='kt-switch kt-switch--outline kt-switch--sm kt-switch--icon kt-switch--success'> <label> <input type='checkbox' data-type='IsActive' data-menuid='#=Id#' > <span></span> </label> </span> </div>" +
                        "# } else { #" +
                        "<div class='col-3 text-center'> <span class='kt-switch kt-switch--outline kt-switch--sm kt-switch--icon kt-switch--success'> <label> <input type='checkbox' data-type='IsActive'  checked='' data-menuid='#=Id#'> <span></span> </label> </span> </div>" +
                        "# } #",
                    filterable: false,
                    width: 50,
                },{
                    field: "Id",
                    title:"İşlemler",
                    width: 50,
                    filterable: false,
                    headerAttributes: { style: "text-align:center" },
                    attributes: { style: "text-align:center" },
                        template: '<a href="/Admin/menu/addoredit/#=Id#" class="btn btn-sm btn-clean btn-icon" title="Edit details">\
                                    <i class="la la-edit"></i>\
                                </a>'
                }
                ]
            });
        });
        $("body").on("click", "#menu_datatable input[data-menuid]", function () {
            var id = $(this).attr("data-menuid");
            var checked = $(this).prop("checked");
            var type = $(this).attr("data-type");

            if (type == "IsActive") {
                $.ajax({
                type: "POST",
                    url: "/Admin/Menu/ChangeIsActiveMenu",
                data: { menuId: id, isChecked: checked },
                success: function (data) {
                    Swal.fire({
                        title: 'Başarılı',
                        icon: 'success',
                        showCancelButton: false,
                        showConfirmButton: false,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Evet',
                        cancelButtonText: 'Hayır',
                        timer: 250,
                        timerProgressBar: true
                    });
                }
            });
            }
            if (type == "IsHidden") {
                $.ajax({
                    type: "POST",
                    url: "/Admin/Menu/ChangeIsHiddenMenu",
                    data: { menuId: id, isChecked: checked },
                    success: function (data) {
                        Swal.fire({
                            title: 'Başarılı',
                            icon: 'success',
                            showCancelButton: false,
                            showConfirmButton: false,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            confirmButtonText: 'Evet',
                            cancelButtonText: 'Hayır',
                            timer: 250,
                            timerProgressBar: true
                        });
                    }
                });
            }
        });
    </script>
}